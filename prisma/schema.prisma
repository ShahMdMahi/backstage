generator client {
  provider = "prisma-client"
  output   = "../lib/prisma"
}

datasource db {
  provider = "postgresql"
}

enum ROLE {
  DEVELOPER
  SYSTEM_ADMIN
  USER
}

enum SESSION_DEVICE_TYPE {
  DESKTOP
  TABLET
  MOBILE
  CONSOLE
  EMBEDDED
  SMARTTV
  WEARABLE
  XR
  OTHER
}

enum WORKSPACE_ACCOUNT_TYPE {
  B2B
  LABEL
  ARTIST
}

enum WORKSPACE_ACCOUNT_STATUS {
  ACTIVE
  SUSPENDED
  CANCELLED
}

enum WORKSPACE_ACCOUNT_ACCESS_ROLE {
  ADMIN
  MANAGER
  ARTIST
  MEMBER
}

enum WORKSPACE_ACCOUNT_ACCESS_STATUS {
  ACTIVE
  SUSPENDED
}

enum AUDIT_LOG_ACTION {
  // User Actions
  USER_REGISTERED
  USER_LOGGED_IN
  USER_LOGGED_OUT
  USER_RESEND_VERIFICATION
  USER_FORGOT_PASSWORD
  USER_RESET_PASSWORD
  USER_VERIFIED
  USER_SUSPENDED
  USER_APPROVED
  USER_PASSWORD_CHANGED
  USER_UPDATED
  USER_DELETED

  // Session Actions
  SESSION_CREATED
  SESSION_REVOKED
  SESSION_ACCESSED

  // Workspace Account Actions
  WORKSPACE_ACCOUNT_CREATED
  WORKSPACE_ACCOUNT_UPDATED
  WORKSPACE_ACCOUNT_DELETED
}

enum AUDIT_LOG_ENTITY {
  USER
  SESSION
}

model User {
  // Primary Key
  id String @id @default(cuid())

  // Foreign Keys

  // Fields
  name     String
  email    String  @unique
  password String
  phone    String
  avatar   String?

  // Enums
  role ROLE @default(USER)

  // Relations
  sessions                         Session[]
  ownWorkspaceAccount              WorkspaceAccount?
  sharedWorkspaceAccountAccesses   SharedWorkspaceAccountAccess[] @relation("SharedWorkspaceAccountAccessUser")
  assignedWorkspaceAccountAccesses SharedWorkspaceAccountAccess[] @relation("SharedWorkspaceAccountAccessAssigner")
  auditLogs                        AuditLog[]

  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  verifiedAt  DateTime?
  approvedAt  DateTime?
  suspendedAt DateTime?

  // Indexes & Constraints
}

model Session {
  // Primary Key
  id String @id @default(cuid())

  // Foreign Keys
  userId String

  // Fields
  token             String @unique
  userAgent         String
  ipAddress         String
  deviceFingerprint String
  metadata          Json?

  // Enums
  deviceType SESSION_DEVICE_TYPE @default(OTHER)

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  expiresAt  DateTime
  revokedAt  DateTime?
  accessedAt DateTime?

  // Indexes & Constraints
  @@index([token]) // Ensures fast lookups by token (e.g., during authentication).
  @@index([userId]) // Speeds up queries filtering by user (e.g., get all sessions for a user).
  @@index([expiresAt]) // Optimizes expiration checks (e.g., find expired sessions for cleanup).
  @@index([revokedAt]) // Improves queries for revoked sessions (e.g., filter active ones).
  @@index([accessedAt]) // Enhances recent access queries (e.g., sort by last accessed).
  @@index([userId, expiresAt]) // Composite index for combined user and expiration filters (e.g., active sessions per user).
}

model WorkspaceAccount {
  // Primary Key
  id String @id @default(cuid())

  // Foreign Keys
  ownerId String @unique

  // Fields
  name        String
  legalName   String
  description String
  logo        String
  metadata    Json?

  // Enums
  type   WORKSPACE_ACCOUNT_TYPE
  status WORKSPACE_ACCOUNT_STATUS @default(ACTIVE)

  // Relations
  owner          User                           @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  sharedAccesses SharedWorkspaceAccountAccess[]

  // Timestamps
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  subscriptionStatsAt DateTime
  subscriptionEndsAt  DateTime

  // Indexes & Constraints
}

model SharedWorkspaceAccountAccess {
  // Primary Key
  id String @id @default(cuid())

  // Foreign Keys
  workspaceAccountId String
  userId             String
  assignerId         String

  // Fields
  metadata Json?

  // Enums
  role   WORKSPACE_ACCOUNT_ACCESS_ROLE   @default(MEMBER)
  status WORKSPACE_ACCOUNT_ACCESS_STATUS @default(ACTIVE)

  // Relations
  workspaceAccount WorkspaceAccount @relation(fields: [workspaceAccountId], references: [id], onDelete: Cascade)
  user             User             @relation(name: "SharedWorkspaceAccountAccessUser", fields: [userId], references: [id], onDelete: Cascade)
  assigner         User             @relation(name: "SharedWorkspaceAccountAccessAssigner", fields: [assignerId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Indexes & Constraints
}

model AuditLog {
  // Primary Key
  id String @id @default(cuid())

  // Foreign Keys
  userId String?

  // Fields
  entityId    String?
  bySystem    Boolean @default(false)
  description String?
  metadata    Json?

  // Enums
  action AUDIT_LOG_ACTION
  entity AUDIT_LOG_ENTITY

  // Relations
  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  // Timestamps
  createdAt DateTime @default(now())

  // Indexes & Constraints
}
